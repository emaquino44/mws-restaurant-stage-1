class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static setIndexedDB(){return idb.open("restaurants",1,t=>{t.createObjectStore("restaurants",{keyPath:"id"})})}static getAllCachedRestaurants(){return DBHelper.setIndexedDB().then(t=>{if(!t)return;return t.transaction("restaurants").objectStore("restaurants").getAll()})}static getCachedRestaurant(t){return DBHelper.setIndexedDB().then(e=>{if(!e)return;return e.transaction("restaurants").objectStore("restaurants").get(Number(t))})}static fetchRestaurants(t){DBHelper.getAllCachedRestaurants().then(e=>{if(e.length>0)return t(null,e);fetch(DBHelper.DATABASE_URL).then(t=>t.json()).then(e=>{DBHelper.setIndexedDB().then(r=>{if(!r)return t(null,e);let n=r.transaction("restaurants","readwrite").objectStore("restaurants");e.forEach(t=>n.put(t))}),t(null,e)}).catch(e=>t(e,null))})}static fetchRestaurantById(t,e){DBHelper.getCachedRestaurant(t).then(r=>{if(r)return e(null,r);fetch(`${DBHelper.DATABASE_URL}/${t}`).then(t=>t.json()).then(t=>{DBHelper.setIndexedDB().then(r=>{if(!r)return e(null,t);r.transaction("restaurants","readwrite").objectStore("restaurants").put(t)}),e(null,t)}).catch(t=>e(t,null))})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((r,n)=>{if(r)e(r,null);else{const r=n.filter(e=>e.cuisine_type==t);e(null,r)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((r,n)=>{if(r)e(r,null);else{const r=n.filter(e=>e.neighborhood==t);e(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,r){DBHelper.fetchRestaurants((n,a)=>{if(n)r(n,null);else{let n=a;"all"!=t&&(n=n.filter(e=>e.cuisine_type==t)),"all"!=e&&(n=n.filter(t=>t.neighborhood==e)),r(null,n)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].neighborhood),n=e.filter((t,r)=>e.indexOf(t)==r);t(null,n)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].cuisine_type),n=e.filter((t,r)=>e.indexOf(t)==r);t(null,n)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`/img/${t.photograph}.jpg`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}